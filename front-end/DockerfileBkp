FROM node:14.1-alpine AS builder

WORKDIR /opt/web
COPY package.json package-lock.json ./
RUN npm install
RUN chmod 777 -R /usr/local/lib/node_modules
# RUN mkdir -p /usr/local/lib/node_modules/netlify-cli/node_modules
RUN npm install netlify-cli -g --unsafe-perm

ENV PATH="./node_modules/.bin:$PATH"

COPY . ./
RUN sh build.sh
RUN export NETLIFY_AUTH_TOKEN=UlVbDbbe3HmoG8vVbUDHN74emENjYPUUbqjPhbpDI7s
RUN sh deploy.sh
